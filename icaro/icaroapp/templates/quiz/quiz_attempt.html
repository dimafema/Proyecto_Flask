{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-5"> 
    <h2 class="text-center mb-4">Detalles del Intento</h2>

    {% set total_aciertos = questions | sum(attribute='2') if questions else 0 %}
    {% set total_preguntas = questions | length %}
    {% set resultado_clase = 'bg-danger' if total_aciertos < (total_preguntas / 2) else ('bg-warning' if total_aciertos == (total_preguntas / 2) else 'bg-success') %}

    <div class="card">
        <div class="card-header bg-primary text-white">
            Intento : {{ attempt.id if attempt.id is not none else 'No disponible' }} 
        </div>
        <div class="card-body {{ resultado_clase }}"> <!-- Aplicar color dinÃ¡micamente -->
            <p><strong>Fecha:</strong> {{ attempt.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
            <p><strong>Aciertos:</strong> {{ total_aciertos }} de un total de {{ total_preguntas }}</p>
        </div>
    </div>

    <h3 class="mt-4">Preguntas y Respuestas</h3>
    <div class="table-responsive">
        <table class="table table-striped table-hover w-100"> 
            <thead class="thead-dark">
                <tr>
                    <th>Pregunta</th>
                    <th>Respuesta del Usuario</th>
                    <th>Respuesta Correcta</th>
                </tr>
            </thead>
            <tbody>
                {% for quiz, user_answer, user_score in questions %}
                <tr class="{% if user_score == 1 %}table-success{% else %}table-danger{% endif %}">
                    <td>{{ quiz.ask_name }}</td>
                    <td>{{ user_answer if user_answer else 'No respondida' }}</td>
                    <td>{{ quiz.correct_answer }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" class="text-center">No hay preguntas registradas para este intento.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <a href="{{ url_for('icaro.quiz_results') }}" class="btn btn-secondary mt-3">Volver</a>
</div>
{% endblock %}